<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.js"></script>

<style>

    .attachment {
        margin: 0px auto;
    margin-top: 5%;
    height: 300px;
    width: 95%;
    display: flex;
    max-height: 300px;
    overflow-y: scroll;
    }


    #brand-logo {
        min-width: 300px;
    height: 300px;
    align-items: center;
    justify-content: center;
    background:#ececec;
     display:flex
    }

    #brand-text {
       width: -webkit-fill-available;
       background:#f0f0f0;
       align-items:center;
       flex-direction:column;
       justify-content:center;
       display:flex

    }

    #brand-deptos {
        width: 95%;
        margin: 0px auto;
        display: flex;
        justify-content: space-between;

    }

    .area {
          background: #122143;
    padding: 15px 0;
    margin: 30px auto;
    color: #fff;
    text-transform: uppercase;
    font-weight: 600;
        width: 15%;
        text-align:center
    }

    #contentFile {
        margin: 0px auto;
        width: 95%;
    }
    table {
    background-color: transparent;
    table-layout: auto;
    width: 100%;
    }
    tbody {
    background: #d7d7d7;
    }

    td, th {border: 5px solid #d7d7d7;padding: 5px;}

    th{color:#686868}

    td{font-weight:600}

    .inc, .ad, .gs, .inh, .vtech, .vt, .wp{display:none}

    #IN-C .inc, #AD .ad, #GS .gs, #IN-H .inh, #VTECH .vtech, #VT .vt, #WP .wp{display:block}






    .cd-popup {
        position: fixed;
        left: 0;
        top: 0;
        height: 100%;
        width: 100%;
        background-color: rgba(51, 51, 51, 0.71);
        opacity: 0;
        visibility: hidden;
        -webkit-transition: opacity 0.3s 0s, visibility 0s 0.3s;
        -moz-transition: opacity 0.3s 0s, visibility 0s 0.3s;
        transition: opacity 0.3s 0s, visibility 0s 0.3s;
    }

    .cd-popup.is-visible {
      opacity: 1;
      visibility: visible;
      -webkit-transition: opacity 0.3s 0s, visibility 0s 0s;
      -moz-transition: opacity 0.3s 0s, visibility 0s 0s;
      transition: opacity 0.3s 0s, visibility 0s 0s;
    }

    .cd-popup-container {
      position: relative;
      width: 90%;
      max-width: 400px;
      margin: 4em auto;
      background: #FFF;
      border-radius: .25em .25em .4em .4em;
      text-align: center;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
      -webkit-transform: translateY(-40px);
      -moz-transform: translateY(-40px);
      -ms-transform: translateY(-40px);
      -o-transform: translateY(-40px);
      transform: translateY(-40px);
      /* Force Hardware Acceleration in WebKit */
      -webkit-backface-visibility: hidden;
      -webkit-transition-property: -webkit-transform;
      -moz-transition-property: -moz-transform;
      transition-property: transform;
      -webkit-transition-duration: 0.3s;
      -moz-transition-duration: 0.3s;
      transition-duration: 0.3s;
    }
    .cd-popup-container p {
      padding: 3em 1em;
    }
    .cd-popup-container .cd-buttons:after {
      content: "";
      display: table;
      clear: both;
    }
    .cd-popup-container .cd-buttons li {
      float: left;
      width: 50%;
      list-style: none;
    }
    .cd-popup-container .cd-buttons a {
      display: block;
      height: 60px;
      line-height: 60px;
      text-transform: uppercase;
      color: #FFF;
      -webkit-transition: background-color 0.2s;
      -moz-transition: background-color 0.2s;
      transition: background-color 0.2s;
    }
    .cd-popup-container .cd-buttons li:first-child a {
      background: #fc7169;
      border-radius: 0 0 0 .25em;
    }
    .no-touch .cd-popup-container .cd-buttons li:first-child a:hover {
      background-color: #fc8982;
    }
    .cd-popup-container .cd-buttons li:last-child a {
      background: #b6bece;
      border-radius: 0 0 .25em 0;
    }
    .no-touch .cd-popup-container .cd-buttons li:last-child a:hover {
      background-color: #c5ccd8;
    }
    .cd-popup-container .cd-popup-close {
      position: absolute;
      top: 8px;
      right: 8px;
      width: 30px;
      height: 30px;
    }
    .cd-popup-container .cd-popup-close::before, .cd-popup-container .cd-popup-close::after {
      content: '';
      position: absolute;
      top: 12px;
      width: 14px;
      height: 3px;
      background-color: #8f9cb5;
    }
    .cd-popup-container .cd-popup-close::before {
      -webkit-transform: rotate(45deg);
      -moz-transform: rotate(45deg);
      -ms-transform: rotate(45deg);
      -o-transform: rotate(45deg);
      transform: rotate(45deg);
      left: 8px;
    }
    .cd-popup-container .cd-popup-close::after {
      -webkit-transform: rotate(-45deg);
      -moz-transform: rotate(-45deg);
      -ms-transform: rotate(-45deg);
      -o-transform: rotate(-45deg);
      transform: rotate(-45deg);
      right: 8px;
    }
    .is-visible .cd-popup-container {
      -webkit-transform: translateY(0);
      -moz-transform: translateY(0);
      -ms-transform: translateY(0);
      -o-transform: translateY(0);
      transform: translateY(0);
    }


</style>


<div class="attachment">

    <div id="brand-logo">

        <img class="ad" src="~/UploadedFiles/Logos/Axkan.png" />
        <img class="gs" src="~/UploadedFiles/Logos/Grand_Slam.png" />
        <img class="inc" src="~/UploadedFiles/Logos/INMENSE_Club.png" />
        <img class="inh" src="~/UploadedFiles/Logos/INMENSE_Hotels.png" />
        <img class="vtech" src="~/UploadedFiles/Logos/VTechnology.png" />
        <img class="vt" src="~/UploadedFiles/Logos/VTime.png" />
        <img class="wp" src="~/UploadedFiles/Logos/Worldpass.png" />
    </div>
    <div id="brand-text">
        <p class="inc">
            <b>Inmense hotels</b> es una cadena de hoteles. Nuestro objetivo es crear experi- <br />
            encias memorables: Elegimos propiedades que sean únicas y mantenemos <br />
            su originalidad complementada con una decoración exquisita. <br />
            <br />
            Más que una estancia hotelera buscamos crear una experiencia única, que <br />
            involucre todos los sentidos de nuestros visitantes, desde el olor a madera o <br />
            playa de nuestros hoteles, hasta los platillos preparados por nuestros chefs, <br />
            pasando por un msaje ala luz de lasvelaso unacenaroánticaen medio <br />
            de la neblina. <br />
            <br />
            Creemosen lo local y por eso nuestroshotelestienen elementos únicos. <br />
            Nuestro manifiesto culinario usa los ingredientes locales y los mezcla de <br />
        </p>
        <p class="ad">
            Lorem ipsum dolor sit amet, consectetur adipisicing elit. Placeat, <br />
            deleniti pariatur modi est numquam fugit perferendis saepe, blanditiis <br />
            inventore laudantium hic a tenetur aliquam, natus quae perspiciatis quisquam <br />
            veritatis consectetur.
        </p>
        <p class="gs">
            Lorem ipsum dolor sit amet, consectetur adipisicing elit. Placeat, <br />
            deleniti pariatur modi est numquam fugit perferendis saepe, blanditiis <br />
            inventore laudantium hic a tenetur aliquam, natus quae perspiciatis quisquam <br />
            veritatis consectetur.
        </p>
        <p class="inh">
            Lorem ipsum dolor sit amet, consectetur adipisicing elit. Placeat, <br />
            deleniti pariatur modi est numquam fugit perferendis saepe, blanditiis <br />
            inventore laudantium hic a tenetur aliquam, natus quae perspiciatis quisquam <br />
            veritatis consectetur.
        </p>
        <p class="vt">
            Lorem ipsum dolor sit amet, consectetur adipisicing elit. Placeat, <br />
            deleniti pariatur modi est numquam fugit perferendis saepe, blanditiis <br />
            inventore laudantium hic a tenetur aliquam, natus quae perspiciatis quisquam <br />
            veritatis consectetur.
        </p>
        <p class="vtech">
            Lorem ipsum dolor sit amet, consectetur adipisicing elit. Placeat, <br />
            deleniti pariatur modi est numquam fugit perferendis saepe, blanditiis <br />
            inventore laudantium hic a tenetur aliquam, natus quae perspiciatis quisquam <br />
            veritatis consectetur.
        </p>
        <p class="wp">
            Lorem ipsum dolor sit amet, consectetur adipisicing elit. Placeat, <br />
            deleniti pariatur modi est numquam fugit perferendis saepe, blanditiis <br />
            inventore laudantium hic a tenetur aliquam, natus quae perspiciatis quisquam <br />
            veritatis consectetur.
        </p>

    </div>
    <div class="cd-popup" role="alert">
        <div class="cd-popup-container">
            <p>¿Deseas borrar el siguiente Archivo?</p>
            <ul class="cd-buttons">
                <li><a href="#0">Si</a></li>
                <li><a href="#0">No</a></li>
            </ul>
            <a href="#0" class="cd-popup-close img-replace">Close</a>
        </div> 
    </div>
</div>
<div id="brand-deptos"></div>
<div id="contentFile">
    <table id="attachments">
        <tr>
            <th>File ID</th>
            <th>Nombre</th>
            <th>Empresa</th>
            
        </tr>
        
    </table>
</div>

<script>
   
    let tmp = "@ViewBag.D";
    let deptos = JSON.parse(tmp.replace(/&quot;/g, '"'));
    let tagClabe = '';

    //show area or deptos in view
    showArea(deptos);
    tagClabe = getUrlParam();

    $('.attachment').attr('id', tagClabe);

    //show files attachment of brand
    getFilesAttch(tagClabe);

    

    function getFilesAttch(tagClabe) {
        //console.log('Entra a getFiles');
        //console.log(tagClabe);

        $.ajax({
            url: '/Home/GetFilesAttach/',
            data: { tagClabe: tagClabe },
            dataType: 'json',
            type: 'GET',
            contentType: 'application/json; charset=utf-8',
            asyn: 'true',
            processData: 'false',
            cache: 'false',
            success: function (data) {

                let json = JSON.parse(data);
                console.log(json);
                let table = document.querySelector('#attachments');

                for (let i = 0; i < json.length; i++) {

                    let tr = document.createElement('TR');

                    let td_id = document.createElement('TD');
                    let td_file = document.createElement('TD');
                    let td_tag = document.createElement('TD');
                    let td_show = document.createElement('TD');
                    let td_edit = document.createElement('TD');
                    let td_del = document.createElement('TD');
                    let a_show = document.createElement('a');
                    let a_edit = document.createElement('a');
                    let a_del = document.createElement('a');

                    //show file
                    a_show.innerHTML = 'Ver Documento';
                    a_show.setAttribute('id', json[i]['IdAttachment']);
                    a_show.setAttribute('href', '/UploadedFiles/attachments/' + json[i]['AttachmentName']);
                    a_show.setAttribute('target', '_blank');
                    a_show.setAttribute('class', 'fileShow');
                    //edit file
                    a_edit.innerHTML = 'Editar Documento';
                    a_edit.setAttribute('href', json[i]['AttachmentName']);
                    a_edit.setAttribute('id', json[i]['IdAttachment']);
                    a_edit.setAttribute('class', 'fileEdit');
                    //delete file
                    a_del.innerHTML = 'Eliminar Documento';
                    a_del.setAttribute('href', json[i]['IdAttachment']);
                    a_del.setAttribute('id', 'deleteFile');
                    
                    td_id.innerHTML = json[i]['IdAttachment'];
                    td_file.innerHTML = json[i]['AttachmentName'];
                    td_tag.innerHTML = json[i]['TagName'];
                    td_show.appendChild(a_show);
                    td_edit.appendChild(a_edit);
                    td_del.appendChild(a_del);
                    
                    tr.append(td_id);
                    tr.append(td_file);
                    tr.append(td_tag);
                    tr.append(td_show);
                    tr.append(td_edit);
                    tr.append(td_del);

                    table.append(tr);

                }
            },
            error: function (e) {

            }
        });
    }

    function getUrlParam() {

        let url_string = window.location.href;
        let url = new URL(url_string);
        let tagClabe = url.searchParams.get('tag');
        //console.log(tagClabe);

        return tagClabe;
    }

    function showArea(deptos){
        for (let i = 0; i < deptos.length; i++) {

            let brandDeptos = document.querySelector('#brand-deptos');
            let deptoName = deptos[i].DeptoName;
            let div = document.createElement('DIV');
            div.setAttribute('class', 'area');
            div.append(deptoName);
            //console.log(div.innerHTML);
            brandDeptos.appendChild(div);
        }
    }

    function setEventEditFile() {

        let files = document.querySelectorAll('.fileEdit');
        console.log(files);

        for (let i = 0; i < files.length; i++) {
            $(files[i]).click(function (e) {
                e.preventDefault();

                //alert('click');
                let idAttachment = $(this).attr('id');
                console.log('idFile: ' + idAttachment + ' tag: ' + tagClabe);

                document.querySelector('#titleModalManual').innerHTML = 'Editar Manual';
                $('#uploadFileModal').modal('show');
                let fileName = $(files[i]).attr('href');
                console.log(fileName);
                document.querySelector('#titlePdf').innerHTML = fileName;
                //alert("edit file");
                /*$.ajax({
                    url: '/Home/GetAttachment/',
                    data: { tagClabe: tagClabe, idAttachment: idAttachment},
                    dataType: 'json',
                    type: 'GET',
                    contentType: 'application/json; charset=utf-8',
                    asyn: 'true',
                    processData: 'false',
                    cache: 'false',
                    success: function (data) {

                    },
                    error: function (e) {

                    }
                });*/
            });
        }
    }

    $(document).ready(function () {

        //set event click show file
        setEventEditFile();

        $('#deleteFile').click(function (e) {
            e.preventDefault();

            $('.cd-popup').addClass('is-visible');

            //close popup
            $('.cd-popup').on('click', function (event) {
                if ($(event.target).is('.cd-popup-close') || $(event.target).is('.cd-popup')) {
                    event.preventDefault();
                    $(this).removeClass('is-visible');
                }
            });
            //close popup when clicking the esc keyboard button
            $(document).keyup(function (event) {
                if (event.which == '27') {
                    $('.cd-popup').removeClass('is-visible');
                }
            });
        });



    });
    
</script>
